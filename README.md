# DCA Analysis Tool

A Python script that analyzes Bitcoin (BTC/USDT) price data from Binance to determine optimum times for Dollar Cost Averaging (DCA). The analysis timezone is configurable (default: `Asia/Bangkok`).

## Features

- **Multi-Period Analysis**: Analyzes data over the last 14, 30, 45, and 60 days to capture short-term and medium-term trends.
- **Daily Low Frequency**: Identifies which 15-minute time slot most frequently captures the daily low price.
- **Advanced DCA Metrics**: 
  - **Median Miss**: Calculates how much you typically "overpay" relative to the absolute daily bottom (Efficiency Metric).
  - **Win Rate**: Percentage of days where the chosen time bought within 0.5% of the absolute bottom (Consistency Metric).
- **AI Analysis**: Uses Google Gemini (automatically selects best model: 2.5/2.0 Flash) to interpret data and recommend a specific time.
- **Discord Integration**: Automatically sends the analysis report to a Discord channel via Webhook.

## Prerequisites

- Python 3.9+
- `pip` packages: `ccxt`, `pandas`, `requests`, `google-generativeai`

## Setup

1. **Clone the repository**
2. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```
3. **Set Environment Variables**:
   - `GEMINI_API_KEY`: Your Google AI Studio API Key.
   - `DISCORD_WEBHOOK_URL`: (Optional) Webhook for Discord notifications.
   - `TIMEZONE`: Your local timezone (default: `Asia/Bangkok`).
   - `EXCHANGE_ID`: `binance` or `binanceus` (default: `binance`).

## GHA Automation

The included GitHub Actions workflow runs the analysis automatically at the end of every month. It includes:
- **Smart Model Selection**: Prioritizes fast "Flash" models to avoid free-tier rate limits.
- **Pip Caching**: Speeds up runs by caching dependencies.

## Usage

Run manually:
```bash
python3 btc-analysis.py
```

## Installation

1. Clone the repository or download the script.
2. Install the required dependencies:

```bash
pip install ccxt pandas requests google-generativeai
```

## Configuration

The script is configured with the following defaults in `btc-analysis.py`, which can be overridden by environment variables:

- **Exchange**: `binance` (default) or `EXCHANGE_ID` (e.g., `binanceus` for US users)
- **Symbol**: `BTC/USDT`
- **Timeframe**: `15m` (15 minutes)
- **Timezone**: `Asia/Bangkok` (default) or `TIMEZONE` env var
- **Lookback Periods**: 7, 15, 30, 60 days

## Usage

1. (Optional) Set up the `DISCORD_WEBHOOK_URL` environment variable if you want to receive reports on Discord.
   
   **Mac/Linux:**
   ```bash
   export DISCORD_WEBHOOK_URL="your_webhook_url_here"
   # If running from a US IP address, use binanceus to avoid geo-blocking:
   export EXCHANGE_ID="binanceus"
   
   # For AI Analysis (Get key from https://aistudio.google.com/app/apikey)
   export GEMINI_API_KEY="AIza..."
   ```

   **Windows (PowerShell):**
   ```powershell
   $env:DISCORD_WEBHOOK_URL="your_webhook_url_here"
   $env:EXCHANGE_ID="binanceus"
   $env:GEMINI_API_KEY="AIza..."
   ```

2. Run the script:

```bash
python btc-analysis.py
```

## Output

The script prints a report to the console (and Discord) containing:

1. **Range**: The start and end dates of the analyzed data.
2. **Most frequent DAILY-LOW time**: The time of day (HH:MM) that has the highest probability of being the daily low.
3. **Best Realistic DCA Price**: The time of day that offers the best "DCA Price" (harmonic mean of close prices) and the average discount relative to the daily mean.

## Files

- `btc-analysis.py`: Main analysis script.
- `*.csv`: (Optional) CSV files that may contain historical data or previous analysis results (not generated by the current script version).
